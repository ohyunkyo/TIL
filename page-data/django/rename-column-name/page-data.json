{
    "componentChunkName": "component---src-templates-blog-post-js",
    "path": "/django/rename-column-name/",
    "result": {"data":{"site":{"siteMetadata":{"title":"Today I Learned"}},"markdownRemark":{"id":"b74a755f-9e39-5309-9e9a-93d337fadea0","excerpt":"…","html":"<h2>0. 서론</h2>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># model.py</span>\r\n\r\n<span class=\"token comment\"># 상품 정의</span>\r\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Product</span><span class=\"token punctuation\">(</span>models<span class=\"token punctuation\">.</span>Model<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n  name <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>CharField<span class=\"token punctuation\">(</span>max_length<span class=\"token operator\">=</span><span class=\"token number\">64</span><span class=\"token punctuation\">,</span> unique<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>\r\n  description <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>TextField<span class=\"token punctuation\">(</span>null<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">,</span> blank<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>\r\n  business <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>ForeignKey<span class=\"token punctuation\">(</span>Business<span class=\"token punctuation\">,</span> on_delete<span class=\"token operator\">=</span>models<span class=\"token punctuation\">.</span>PROTECT<span class=\"token punctuation\">)</span>\r\n  maximum_quantity <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>SmallIntegerField<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\n\r\n  <span class=\"token keyword\">class</span> <span class=\"token class-name\">Meta</span><span class=\"token punctuation\">:</span>\r\n      verbose_name <span class=\"token operator\">=</span> <span class=\"token string\">'상품 정의'</span>\r\n\r\n\r\n<span class=\"token comment\"># 부자재</span>\r\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Supplement</span><span class=\"token punctuation\">(</span>models<span class=\"token punctuation\">.</span>Model<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n  name <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>CharField<span class=\"token punctuation\">(</span>max_length<span class=\"token operator\">=</span><span class=\"token number\">64</span><span class=\"token punctuation\">,</span> unique<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>\r\n  description <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>TextField<span class=\"token punctuation\">(</span>null<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">,</span> blank<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>\r\n  business <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>ForeignKey<span class=\"token punctuation\">(</span>Business<span class=\"token punctuation\">,</span> on_delete<span class=\"token operator\">=</span>models<span class=\"token punctuation\">.</span>PROTECT<span class=\"token punctuation\">)</span>\r\n  maximum_quantity <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>SmallIntegerField<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\n\r\n  <span class=\"token keyword\">class</span> <span class=\"token class-name\">Meta</span><span class=\"token punctuation\">:</span>\r\n      verbose_name <span class=\"token operator\">=</span> <span class=\"token string\">'부자재'</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># model.py</span>\r\n\r\n<span class=\"token comment\"># 상품 재고 처리 기록</span>\r\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">ProductHistory</span><span class=\"token punctuation\">(</span>models<span class=\"token punctuation\">.</span>Model<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n  business <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>ForeignKey<span class=\"token punctuation\">(</span>Business<span class=\"token punctuation\">,</span> on_delete<span class=\"token operator\">=</span>models<span class=\"token punctuation\">.</span>PROTECT<span class=\"token punctuation\">,</span> blank<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>\r\n  product <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>ForeignKey<span class=\"token punctuation\">(</span>Product<span class=\"token punctuation\">,</span> on_delete<span class=\"token operator\">=</span>models<span class=\"token punctuation\">.</span>PROTECT<span class=\"token punctuation\">,</span> blank<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>\r\n  status <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>CharField<span class=\"token punctuation\">(</span>max_length<span class=\"token operator\">=</span><span class=\"token number\">20</span><span class=\"token punctuation\">,</span> default<span class=\"token operator\">=</span><span class=\"token string\">'pending'</span><span class=\"token punctuation\">,</span> choices<span class=\"token operator\">=</span>common_const<span class=\"token punctuation\">.</span>COMMON_STATUS<span class=\"token punctuation\">)</span>\r\n  quantity <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>IntegerField<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\n  inventory_process <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>ForeignKey<span class=\"token punctuation\">(</span>InventoryProcess<span class=\"token punctuation\">,</span> on_delete<span class=\"token operator\">=</span>models<span class=\"token punctuation\">.</span>PROTECT<span class=\"token punctuation\">)</span>\r\n  expiry_at <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>DateField<span class=\"token punctuation\">(</span>null<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">,</span> blank<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>\r\n  created_at <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>DateTimeField<span class=\"token punctuation\">(</span>auto_now_add<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>\r\n  updated_at <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>DateTimeField<span class=\"token punctuation\">(</span>auto_now<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>\r\n  reserved_at <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>DateTimeField<span class=\"token punctuation\">(</span>null<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">,</span> blank<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>\r\n  admin <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>ForeignKey<span class=\"token punctuation\">(</span>User<span class=\"token punctuation\">,</span> on_delete<span class=\"token operator\">=</span>models<span class=\"token punctuation\">.</span>PROTECT<span class=\"token punctuation\">,</span> blank<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>\r\n\r\n  <span class=\"token keyword\">class</span> <span class=\"token class-name\">Meta</span><span class=\"token punctuation\">:</span>\r\n      verbose_name <span class=\"token operator\">=</span> <span class=\"token string\">'상품 재고 처리 기록'</span>\r\n      indexes <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\r\n        models<span class=\"token punctuation\">.</span>Index<span class=\"token punctuation\">(</span>fields<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span><span class=\"token string\">'status'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'expiry_at'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'created_at'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'updated_at'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'reserved_at'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> name<span class=\"token operator\">=</span><span class=\"token string\">'product_history_common'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token punctuation\">]</span>\r\n\r\n\r\n<span class=\"token comment\"># 부자재 재고 처리 기록</span>\r\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">SupplementHistory</span><span class=\"token punctuation\">(</span>models<span class=\"token punctuation\">.</span>Model<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n  business <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>ForeignKey<span class=\"token punctuation\">(</span>Business<span class=\"token punctuation\">,</span> on_delete<span class=\"token operator\">=</span>models<span class=\"token punctuation\">.</span>PROTECT<span class=\"token punctuation\">,</span> blank<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>\r\n  supplement <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>ForeignKey<span class=\"token punctuation\">(</span>Supplement<span class=\"token punctuation\">,</span> on_delete<span class=\"token operator\">=</span>models<span class=\"token punctuation\">.</span>PROTECT<span class=\"token punctuation\">,</span> blank<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>\r\n  status <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>CharField<span class=\"token punctuation\">(</span>max_length<span class=\"token operator\">=</span><span class=\"token number\">20</span><span class=\"token punctuation\">,</span> default<span class=\"token operator\">=</span><span class=\"token string\">'pending'</span><span class=\"token punctuation\">,</span> choices<span class=\"token operator\">=</span>common_const<span class=\"token punctuation\">.</span>COMMON_STATUS<span class=\"token punctuation\">)</span>\r\n  quantity <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>IntegerField<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\n  inventory_process <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>ForeignKey<span class=\"token punctuation\">(</span>InventoryProcess<span class=\"token punctuation\">,</span> on_delete<span class=\"token operator\">=</span>models<span class=\"token punctuation\">.</span>PROTECT<span class=\"token punctuation\">)</span>\r\n  expiry_at <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>DateField<span class=\"token punctuation\">(</span>null<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">,</span> blank<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>\r\n  created_at <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>DateTimeField<span class=\"token punctuation\">(</span>auto_now_add<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>\r\n  updated_at <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>DateTimeField<span class=\"token punctuation\">(</span>auto_now<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>\r\n  reserved_at <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>DateTimeField<span class=\"token punctuation\">(</span>null<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">,</span> blank<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>\r\n  admin <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>ForeignKey<span class=\"token punctuation\">(</span>User<span class=\"token punctuation\">,</span> on_delete<span class=\"token operator\">=</span>models<span class=\"token punctuation\">.</span>PROTECT<span class=\"token punctuation\">,</span> blank<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>\r\n\r\n  <span class=\"token keyword\">class</span> <span class=\"token class-name\">Meta</span><span class=\"token punctuation\">:</span>\r\n      verbose_name <span class=\"token operator\">=</span> <span class=\"token string\">'부자재 재고 처리 기록'</span>\r\n      indexes <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\r\n        models<span class=\"token punctuation\">.</span>Index<span class=\"token punctuation\">(</span>fields<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span><span class=\"token string\">'status'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'expiry_at'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'created_at'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'updated_at'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'reserved_at'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> name<span class=\"token operator\">=</span><span class=\"token string\">'supplement_history_common'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token punctuation\">]</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">ProductInventory</span><span class=\"token punctuation\">:</span>\r\n\r\n\t<span class=\"token comment\"># noinspection PyMethodMayBeStatic</span>\r\n\t<span class=\"token keyword\">def</span> <span class=\"token function\">get_list</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> business_id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n\t\tproduct_history_list <span class=\"token operator\">=</span> ProductHistory<span class=\"token punctuation\">.</span>objects<span class=\"token punctuation\">.</span><span class=\"token builtin\">filter</span><span class=\"token punctuation\">(</span>business_id<span class=\"token operator\">=</span>business_id<span class=\"token punctuation\">,</span> status<span class=\"token operator\">=</span><span class=\"token string\">'complete'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span> \\\r\n\t\t\tvalues<span class=\"token punctuation\">(</span><span class=\"token string\">'product_id'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'expiry_at'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'created_at__date'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'inventory_process__effect'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>order_by<span class=\"token punctuation\">(</span><span class=\"token string\">'product_id'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'expiry_at'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>annotate<span class=\"token punctuation\">(</span>quantity<span class=\"token operator\">=</span>Sum<span class=\"token punctuation\">(</span><span class=\"token string\">'quantity'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span> \\\r\n\t\t\tvalues<span class=\"token punctuation\">(</span><span class=\"token string\">'product_id'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'product__name'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'expiry_at'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'quantity'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'created_at__date'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'inventory_process__effect'</span><span class=\"token punctuation\">)</span>\r\n\r\n\t\t<span class=\"token comment\"># template 에 전달될 상품 재고처리 기록 변수 초기화</span>\r\n\t\tproduct_inventory_list <span class=\"token operator\">=</span> defaultdict<span class=\"token punctuation\">(</span><span class=\"token builtin\">dict</span><span class=\"token punctuation\">)</span>\r\n\r\n\t\t<span class=\"token comment\"># 개별 상품의 재고처리 기록을 가공한다</span>\r\n\t\t<span class=\"token keyword\">for</span> product_history <span class=\"token keyword\">in</span> product_history_list<span class=\"token punctuation\">:</span>\r\n\t\t\t<span class=\"token comment\"># 재고처리 기록의 column 을 변수에 set</span>\r\n\t\t\tproduct_id <span class=\"token operator\">=</span> <span class=\"token builtin\">str</span><span class=\"token punctuation\">(</span>product_history<span class=\"token punctuation\">[</span><span class=\"token string\">'product_id'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\r\n\t\t\tname <span class=\"token operator\">=</span> product_history<span class=\"token punctuation\">[</span><span class=\"token string\">'product__name'</span><span class=\"token punctuation\">]</span>\r\n\t\t\texpiry_at <span class=\"token operator\">=</span> <span class=\"token builtin\">str</span><span class=\"token punctuation\">(</span>product_history<span class=\"token punctuation\">[</span><span class=\"token string\">'expiry_at'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\r\n\t\t\tquantity <span class=\"token operator\">=</span> <span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span>product_history<span class=\"token punctuation\">[</span><span class=\"token string\">'quantity'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\r\n\t\t\teffect <span class=\"token operator\">=</span> product_history<span class=\"token punctuation\">[</span><span class=\"token string\">'inventory_process__effect'</span><span class=\"token punctuation\">]</span>\r\n\r\n\t\t\t<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\r\n\r\n\t\t<span class=\"token keyword\">return</span> <span class=\"token builtin\">dict</span><span class=\"token punctuation\">(</span>product_inventory_list<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>items<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\n\r\n\r\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">SupplementInventory</span><span class=\"token punctuation\">:</span>\r\n\r\n\t<span class=\"token comment\"># noinspection PyMethodMayBeStatic</span>\r\n\t<span class=\"token keyword\">def</span> <span class=\"token function\">get_list</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> business_id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n\t\tsupplement_history_list <span class=\"token operator\">=</span> SupplementHistory<span class=\"token punctuation\">.</span>objects<span class=\"token punctuation\">.</span><span class=\"token builtin\">filter</span><span class=\"token punctuation\">(</span>business_id<span class=\"token operator\">=</span>business_id<span class=\"token punctuation\">,</span> status<span class=\"token operator\">=</span><span class=\"token string\">'complete'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span> \\\r\n\t\t\tvalues<span class=\"token punctuation\">(</span><span class=\"token string\">'supplement_id'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'expiry_at'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'created_at__date'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'inventory_process__effect'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>order_by<span class=\"token punctuation\">(</span><span class=\"token string\">'supplement_id'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'expiry_at'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>annotate<span class=\"token punctuation\">(</span>quantity<span class=\"token operator\">=</span>Sum<span class=\"token punctuation\">(</span><span class=\"token string\">'quantity'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span> \\\r\n\t\t\tvalues<span class=\"token punctuation\">(</span><span class=\"token string\">'supplement_id'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'supplement__name'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'expiry_at'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'quantity'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'created_at__date'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'inventory_process__effect'</span><span class=\"token punctuation\">)</span>\r\n\r\n\t\t<span class=\"token comment\"># template 에 전달될 부자재 재고처리 기록 변수 초기화</span>\r\n\t\tsupplement_inventory_list <span class=\"token operator\">=</span> defaultdict<span class=\"token punctuation\">(</span><span class=\"token builtin\">dict</span><span class=\"token punctuation\">)</span>\r\n\r\n\t\t<span class=\"token comment\"># 개별 부자재의 재고처리 기록을 가공한다</span>\r\n\t\t<span class=\"token keyword\">for</span> supplement_history <span class=\"token keyword\">in</span> supplement_history_list<span class=\"token punctuation\">:</span>\r\n\t\t\t<span class=\"token comment\"># 재고처리 기록의 column 을 변수에 set</span>\r\n\t\t\tsupplement_id <span class=\"token operator\">=</span> <span class=\"token builtin\">str</span><span class=\"token punctuation\">(</span>supplement_history<span class=\"token punctuation\">[</span><span class=\"token string\">'supplement_id'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\r\n\t\t\tname <span class=\"token operator\">=</span> supplement_history<span class=\"token punctuation\">[</span><span class=\"token string\">'supplement__name'</span><span class=\"token punctuation\">]</span>\r\n\t\t\texpiry_at <span class=\"token operator\">=</span> <span class=\"token builtin\">str</span><span class=\"token punctuation\">(</span>supplement_history<span class=\"token punctuation\">[</span><span class=\"token string\">'expiry_at'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\r\n\t\t\tquantity <span class=\"token operator\">=</span> <span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span>supplement_history<span class=\"token punctuation\">[</span><span class=\"token string\">'quantity'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\r\n\t\t\teffect <span class=\"token operator\">=</span> supplement_history<span class=\"token punctuation\">[</span><span class=\"token string\">'inventory_process__effect'</span><span class=\"token punctuation\">]</span>\r\n\t\t\t\r\n\t\t\t<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\r\n\t\t\t\r\n        <span class=\"token keyword\">return</span> <span class=\"token builtin\">dict</span><span class=\"token punctuation\">(</span>supplement_inventory_list<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>items<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\n</code></pre></div>\n<p>테이블 명만 다르고 컬럼명은 모두 일치하는 서로 다른 두개의 모델이 같은 과정을 거쳐 같은 형태의 데이터를 리턴하길 원했다.<br>\n처음에는 다른 방법이 생각나지 않아 일단 각 모델별 메서드에서 똑같은 코드를 반복해서 사용했다.<br>\n이후 코드를 재사용할 수 있도록 하나의 메서드에서 컨트롤 가능하도록 만드려고 했는데,<br>\n그러기 위해선 각 쿼리셋이 동일한 key 를 가진 dict 를 반환하도록 하는게 좋을것 같았다.</p>\n<h2>1. annotate 사용하기</h2>\n<p>django 의 기능인 annotation 을 사용하여 컬럼 이름을 바꾼채로 리턴하도록 할 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># 예제</span>\r\n\r\n<span class=\"token keyword\">from</span> django<span class=\"token punctuation\">.</span>db<span class=\"token punctuation\">.</span>models <span class=\"token keyword\">import</span> F\r\n\r\nMyModel<span class=\"token punctuation\">.</span>objects<span class=\"token punctuation\">.</span>annotate<span class=\"token punctuation\">(</span>renamed_value<span class=\"token operator\">=</span>F<span class=\"token punctuation\">(</span><span class=\"token string\">'cryptic_value_name'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>values<span class=\"token punctuation\">(</span><span class=\"token string\">'renamed_value'</span><span class=\"token punctuation\">)</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># 적용</span>\r\n\r\n<span class=\"token keyword\">from</span> django<span class=\"token punctuation\">.</span>db<span class=\"token punctuation\">.</span>models <span class=\"token keyword\">import</span> F\r\n\r\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">InventoryBusiness</span><span class=\"token punctuation\">:</span>\r\n    <span class=\"token keyword\">def</span> <span class=\"token function\">__init__</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> business_id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n        self<span class=\"token punctuation\">.</span>business_id <span class=\"token operator\">=</span> business_id\r\n\r\n    <span class=\"token keyword\">def</span> <span class=\"token function\">get_product_inventory</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n        queryset <span class=\"token operator\">=</span> ProductHistory<span class=\"token punctuation\">.</span>objects<span class=\"token punctuation\">.</span><span class=\"token builtin\">filter</span><span class=\"token punctuation\">(</span>business_id<span class=\"token operator\">=</span>self<span class=\"token punctuation\">.</span>business_id<span class=\"token punctuation\">,</span> status<span class=\"token operator\">=</span><span class=\"token string\">'complete'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span> \\\r\n            values<span class=\"token punctuation\">(</span><span class=\"token string\">'product_id'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'expiry_at'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'created_at__date'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'inventory_process__effect'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>order_by<span class=\"token punctuation\">(</span><span class=\"token string\">'product_id'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'expiry_at'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>\\\r\n            annotate<span class=\"token punctuation\">(</span>quantity<span class=\"token operator\">=</span>Sum<span class=\"token punctuation\">(</span><span class=\"token string\">'quantity'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> model_pk<span class=\"token operator\">=</span>F<span class=\"token punctuation\">(</span><span class=\"token string\">'product_id'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> model_name<span class=\"token operator\">=</span>F<span class=\"token punctuation\">(</span><span class=\"token string\">'product__name'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span> \\\r\n            values<span class=\"token punctuation\">(</span><span class=\"token string\">'model_pk'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'model_name'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'expiry_at'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'quantity'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'created_at__date'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'inventory_process__effect'</span><span class=\"token punctuation\">)</span>\r\n    \r\n        <span class=\"token keyword\">return</span> self<span class=\"token punctuation\">.</span>get_inventory<span class=\"token punctuation\">(</span>queryset<span class=\"token punctuation\">)</span>\r\n    \r\n    <span class=\"token keyword\">def</span> <span class=\"token function\">get_supplement_inventory</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n        queryset <span class=\"token operator\">=</span> SupplementHistory<span class=\"token punctuation\">.</span>objects<span class=\"token punctuation\">.</span><span class=\"token builtin\">filter</span><span class=\"token punctuation\">(</span>business_id<span class=\"token operator\">=</span>self<span class=\"token punctuation\">.</span>business_id<span class=\"token punctuation\">,</span> status<span class=\"token operator\">=</span><span class=\"token string\">'complete'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span> \\\r\n            values<span class=\"token punctuation\">(</span><span class=\"token string\">'supplement_id'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'expiry_at'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'created_at__date'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'inventory_process__effect'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>order_by<span class=\"token punctuation\">(</span><span class=\"token string\">'supplement_id'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'expiry_at'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>\\\r\n            annotate<span class=\"token punctuation\">(</span>quantity<span class=\"token operator\">=</span>Sum<span class=\"token punctuation\">(</span><span class=\"token string\">'quantity'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> model_pk<span class=\"token operator\">=</span>F<span class=\"token punctuation\">(</span><span class=\"token string\">'supplement_id'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> model_name<span class=\"token operator\">=</span>F<span class=\"token punctuation\">(</span><span class=\"token string\">'supplement__name'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span> \\\r\n            values<span class=\"token punctuation\">(</span><span class=\"token string\">'model_pk'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'model_name'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'expiry_at'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'quantity'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'created_at__date'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'inventory_process__effect'</span><span class=\"token punctuation\">)</span>\r\n    \r\n        <span class=\"token keyword\">return</span> self<span class=\"token punctuation\">.</span>get_inventory<span class=\"token punctuation\">(</span>queryset<span class=\"token punctuation\">)</span>\r\n        \r\n    <span class=\"token keyword\">def</span> <span class=\"token function\">get_inventory</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> queryset<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n        <span class=\"token keyword\">for</span> model_history <span class=\"token keyword\">in</span> queryset<span class=\"token punctuation\">:</span>\r\n            model_pk <span class=\"token operator\">=</span> model_history<span class=\"token punctuation\">[</span><span class=\"token string\">'model_pk'</span><span class=\"token punctuation\">]</span>\r\n            <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></code></pre></div>\n<h2>99. 끝나고 나서</h2>\n<h3>테이블을 구분한 이유</h3>\n<p>지금보니 상품, 부자재 테이블을 나눌 필요가 전혀 없었던것 같다.<br>\n하나의 테이블에서 상품인지 부자재인지만 구분하면 됐을텐데 괜히 테이블도 두개로 나누고 재고 테이블도 둘로 분리되어 관리가 어렵게 된것 같아 보인다.<br>\n시간이 된다면 마이그레이션을 진행해서 하나로 통합하고 싶다.</p>\n<h3>annotate 사용하기</h3>\n<p>어노테이션은 새로운 컬럼을 추가하는것과 같다고 한다.<br>\n현재 품목별 재고보기에서 파이썬으로 처리하는 부분을 어노테이션을 사용하여 추가 작업 없이 쿼리만으로 해결 가능할것 같다.</p>\n<p><a href=\"http://raccoonyy.github.io/django-annotate-and-aggregate-like-as-excel/\">출처</a></p>","frontmatter":{"title":"django orm 에서 column name 변경하여 리턴하기","date":"April 21, 2022","description":null},"fields":{"category":"django","slug":"/django/rename-column-name/"}},"previous":{"fields":{"slug":"/django/django-db-transaction/"},"frontmatter":{"title":"django 에서 트랜잭션 적용하기"}},"next":{"fields":{"slug":"/vue-js/axios-modularization/"},"frontmatter":{"title":"axios 모듈화 하기"}}},"pageContext":{"id":"b74a755f-9e39-5309-9e9a-93d337fadea0","previousPostId":"effd14f2-b610-5927-b3f6-a05ead41f7f7","nextPostId":"3bda045d-bcae-5a38-807e-22eabcfc13f8"}},
    "staticQueryHashes": ["230163734","2841359383","3496359572"]}