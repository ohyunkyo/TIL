{
    "componentChunkName": "component---src-templates-blog-post-js",
    "path": "/devops/post-build-in-jenkins-pipeline/",
    "result": {"data":{"site":{"siteMetadata":{"title":"Today I Learned"}},"markdownRemark":{"id":"c8c13fb4-0233-5b10-877e-98b0e4884fb2","excerpt":"0. 서론 현재  의 빌드 후 조치 항목에서  로 알림을 보내고 있다.  이것과 동일한 알림을 파이프라인에서 보내도록 하기 위해 찾아봤다. 1. post 사용하기 아래 예제처럼  블록 뒤  블록을 추가하여 원하는  이 실행되도록 설정해준다…","html":"<h2>0. 서론</h2>\n<p>현재 <code class=\"language-text\">freestyle project</code> 의 빌드 후 조치 항목에서 <code class=\"language-text\">notify.events</code> 로 알림을 보내고 있다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 668px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/TIL/static/cb1a2c6e7ffcd1b25af91fa22b813769/74866/000-current-notiry.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 123.52941176470588%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAZCAYAAAAxFw7TAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACwklEQVQ4y52Uy27VSBCG/YA8x4gXYDcakmFYQJYjMaBhiWY7rBCJWABC0bzAaESCOLn4+Fzc1d1u293ty8k/qrJPBMlJSGLpU9mt9u/qv6qcHB4c4uTkBJPJEYgITdMghIAQ4o+JUfbGGBGbRmJSFAXy+Rz5bIbCaHQxoA0ebQgD/Nw0m4kRPQC7vw+9+xYtgMQYg3/+/Q8HOSGtPGgFqP5sgO/bHsq6a8mVxnJJKGuPJC9KpL//AfdwG+bRY9DWr6CtR6Dt30A//wJ69gJkS1DpQa7eiC49lPOYzBQSW9Y4fv8J2ZtdTN++Q7Zm9x2yN3vIPu4jyw0yZa9kRhbT3GCmLJKqrJAZgwbYSOTIho+mDwXbTNNEJFwtTSQY0jBEoFzBag3Kc1hjoY0RqrpG1/Vo2xZt213Ch8CCAVxp50qJlrGF3BtrZZ3XCudEcJ1pjM0lRLCqKulDRYTVaoW+78+5+Nx13XD8GM/jRRLvPZZ5DqUUNGmJLM5HzHmdSCCtwS1W1/U3YoO3bAFbIYLBe2it5eV8uRTB5RizLAPxh7SG1oNwWbrBBrHDCSzIV9O2SKRyMYg/fPy6ruDrGpw5s87oJhfvE0FJefRo7dOaOEbe00h1r2KsMgtyRReLBebzucSwweybIkXhvwx7yL6sj3gXRJB9Oz09RZpOpe/W2YW7sD7y2Whqv1pJ+e/KMCnew9qxx7yXr/iRcAcS6yocTqaYpqeywFUeGnWIt/bQVg2OFiWyaSrFccUwx3Lv3JUjdpFzQXIRX7ICXw4/4+vXibQOT8g0TaWFvt18XWbfCR6kViqtFIFICzzXPL+3Fuz6DqWPMGoGUgtMsxSLfI6T9Bi2sOLjdWKXBJ+/3sVPT1/i/s6f+GvvA5qmxpJyuMqCjJI/yq0yfPLqb9x7sCO8eL2Hrg2YLRYoa4eitOM8xxsL/g8xKXheltE3BgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"current-notify\"\n        title=\"current-notify\"\n        src=\"/TIL/static/cb1a2c6e7ffcd1b25af91fa22b813769/74866/000-current-notiry.png\"\n        srcset=\"/TIL/static/cb1a2c6e7ffcd1b25af91fa22b813769/5ea4d/000-current-notiry.png 238w,\n/TIL/static/cb1a2c6e7ffcd1b25af91fa22b813769/466da/000-current-notiry.png 475w,\n/TIL/static/cb1a2c6e7ffcd1b25af91fa22b813769/74866/000-current-notiry.png 668w\"\n        sizes=\"(max-width: 668px) 100vw, 668px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>이것과 동일한 알림을 파이프라인에서 보내도록 하기 위해 찾아봤다.</p>\n<h2>1. post 사용하기</h2>\n<p>아래 예제처럼 <code class=\"language-text\">stages</code> 블록 뒤 <code class=\"language-text\">post</code> 블록을 추가하여 원하는 <code class=\"language-text\">step</code> 이 실행되도록 설정해준다</p>\n<div class=\"gatsby-highlight\" data-language=\"jenkinsfile\"><pre class=\"language-jenkinsfile\"><code class=\"language-jenkinsfile\">pipeline {\r\n    agent any\r\n    tools {\r\n        git &quot;git&quot;\r\n    }\r\n    stages {\r\n        stage(&#39;prepare&#39;) {\r\n            steps {\r\n                git branch: &quot;ci-cd-settings&quot;, url: &#39;https://github.com/ohyunkyo/inventory-manage-back.git&#39;                \r\n            }\r\n        }\r\n        stage(&#39;test&#39;) {\r\n            steps {\r\n                sh &quot;pip install -r requirements.txt&quot;\r\n                sh &quot;python3 manage.py makemigrations --settings=config.settings.prod&quot;\r\n                sh &quot;python3 manage.py migrate --settings=config.settings.prod&quot;\r\n                sh &quot;python3 manage.py test --settings=config.settings.prod&quot;\r\n            }\r\n        }\r\n        stage(&#39;deploy&#39;) {\r\n            steps([$class: &#39;BapSshPromotionPublisherPlugin&#39;]) {\r\n                sshPublisher(\r\n                    continueOnError: false, failOnError: true,\r\n                    publishers: [\r\n                        sshPublisherDesc(\r\n                            configName: &quot;inventory backend&quot;,\r\n                            verbose: true,\r\n                            transfers: [\r\n                                sshTransfer(\r\n                                    sourceFiles: &quot;**&quot;,\r\n                                    removePrefix: &quot;&quot;,\r\n                                    remoteDirectory: &quot;deploys&quot;,\r\n                                    execCommand:&quot;cd /home/ec2-user/deploys/; \\\r\n                                    sudo docker-compose up -d; &quot;\r\n                                )\r\n                            ]\r\n                        )\r\n                    ]\r\n                )\r\n            }\r\n        }\r\n    }\r\n    post {\r\n        always {\r\n    \t    notifyEvents (\r\n    \t        token: &quot;notify.event token&quot;,\r\n    \t        message: &quot;&lt;a href=&#39;${env.JOB_URL}&#39;&gt;${env.JOB_NAME}&lt;/a&gt;: #&lt;a href=&#39;${env.BUILD_URL}&#39;&gt;${env.BUILD_NUMBER}&lt;/a&gt; 에 대한 결과: &lt;b&gt;${currentBuild.result}&lt;/b&gt;&lt;br/&gt;&lt;br/&gt;&lt;a href=&#39;${env.BUILD_URL}console&#39;&gt;console log&lt;/a&gt;&quot;\r\n    \t    )\r\n        }\r\n    }\r\n}</code></pre></div>\n<h2>2. 빌드 실행 후 알림 확인하기</h2>\n<p>이제 빌드를 실행하면 모든 <code class=\"language-text\">stage</code> 의 작업이 끝나고 난 후 결과를 텔레그램으로 받을 수 있다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 281px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/TIL/static/d1bbbafb38add30893f0cdc94d9c3e6b/6b1e2/200-telegram-chat.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 27.3109243697479%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABG0lEQVQY01WQ/U6CcBSGvQGdpCIME1C+YiCkGIQfEDLbyjRdrtb938fT/NVa/fHsvHt39uzsNNqqjeqmXE8KBuEaPVzgJBVGVHAzfyDMNgTphuCuwp2VAm9WEGQ1QVrTH8c0ZZNWz6AlmzTaqsUw3uCV77jrM/5yR1y+4uZ7kuKZ5eOJtHphsT2S1Qey+kj5dKY+fFLtPtDchGbvj1DSXPrjW3pGKOgaEzp6QFcP6FyyEdExI7o/XLorPUQaBkjDEHkcC1Hz90LFwphtcVYnrPyAne+xFwfc9Zt4g2JNUZ1EoNgzBn6GNS0ZRSuMcCn6f0JJc8Si6mVofo7m34s5CFYodkLPnCCPIsEla94cI8wZ+pmQKlb8I/sWfgH58ZULNx3USwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"telegram-chat\"\n        title=\"telegram-chat\"\n        src=\"/TIL/static/d1bbbafb38add30893f0cdc94d9c3e6b/6b1e2/200-telegram-chat.png\"\n        srcset=\"/TIL/static/d1bbbafb38add30893f0cdc94d9c3e6b/5ea4d/200-telegram-chat.png 238w,\n/TIL/static/d1bbbafb38add30893f0cdc94d9c3e6b/6b1e2/200-telegram-chat.png 281w\"\n        sizes=\"(max-width: 281px) 100vw, 281px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h2>99. 끝나고 나서</h2>\n<p>각 위치에서 변수를 사용하는 방법이 모두 달랐다.<br>\n<code class=\"language-text\">notifyEvents</code> 스탭에서 사용하는 변수 명에 대한 정보를 찾을수가 없어서 조금 애를 먹었다.<br>\n결국엔 원하는 정보를 얻긴 했지만 전체 변수에 대한 설명이 있는 페이지가 있었으면 좋았을것 같다.(있는데 못찾은걸수도 있음)</p>\n<blockquote>\n<p>2022-06-14 : <a href=\"https://www.jenkins.io/doc/book/pipeline/getting-started/#global-variable-reference\">https://www.jenkins.io/doc/book/pipeline/getting-started/#global-variable-reference</a></p>\n</blockquote>\n<h2>References</h2>\n<p><a href=\"https://medium.com/@gustavo.guss/how-to-do-post-build-in-jenkins-pipeline-d1e7233909b8\">https://medium.com/@gustavo.guss/how-to-do-post-build-in-jenkins-pipeline-d1e7233909b8</a><br>\n<a href=\"https://www.jenkins.io/doc/pipeline/tour/post/\">https://www.jenkins.io/doc/pipeline/tour/post/</a></p>","frontmatter":{"title":"젠킨스 pipeline 에서 빌드 후 조치 실행하기","date":"June 10, 2022","description":null}},"previous":{"fields":{"slug":"/devops/ci-cd-structure-rearchitect/"},"frontmatter":{"title":"CI/CD 구조 재구축"}},"next":{"fields":{"slug":"/tmp/custom-user-model/"},"frontmatter":{"title":"장고 user 모델 커스텀하기"}}},"pageContext":{"id":"c8c13fb4-0233-5b10-877e-98b0e4884fb2","previousPostId":"7fe7f1ef-de44-54ba-8b0a-d872ae2a9c94","nextPostId":"c395d58c-b611-5514-bcbc-461100a5e800"}},
    "staticQueryHashes": ["2841359383","3257411868"]}